<!-- ================= HEADER (RESPONSIVE, FIXED) ================= -->
<header id="pf-header"
        class="fixed top-0 inset-x-0 z-[1300]
               supports-[backdrop-filter]:backdrop-blur
               bg-white/10 dark:bg-slate-900/40 border-b border-white/10">
  <div class="mx-auto max-w-7xl px-4 sm:px-6">
    <div class="h-16 md:h-20 flex items-center justify-between gap-3">
      <!-- Brand -->
      <a href="{{ url_for('home') }}" class="flex items-center gap-3 min-w-0" aria-label="Go to homepage">
        <img alt="Logo" class="w-11 h-11 md:w-12 md:h-12 rounded-xl shadow-lg shrink-0"
             src="{{ url_for('static', filename='images/elderly.jpeg') }}" />
        <div class="min-w-0 leading-tight">
          <div class="text-xl md:text-2xl font-extrabold tracking-tight
                      bg-gradient-to-r from-blue-500 via-purple-500 to-pink-500 bg-clip-text text-transparent animate-gradient truncate">
            PersonFinder
          </div>
          <p class="text-[12px] md:text-sm text-white/85">Reunite Loved Ones</p>
        </div>
      </a>

      <!-- Desktop Nav -->
      <nav class="hidden md:flex flex-1 justify-center pl-12 lg:pl-20">
        <ul class="flex items-center gap-2 lg:gap-4 relative translate-x-4">
          <span id="pf-active-underline"
                class="absolute -bottom-2 h-0.5 bg-white/70 rounded-full transition-all duration-300"
                style="left:0;width:0;"></span>

          <li><a href="{{ url_for('home') }}" class="pf-link {% if request.endpoint == 'home' %}is-active{% endif %}">Home</a></li>
          <li><a href="{{ url_for('register') }}" class="pf-link {% if request.endpoint == 'register' %}is-active{% endif %}">Register</a></li>
          <li><a href="{{ url_for('search') }}" class="pf-link {% if request.endpoint == 'search' %}is-active{% endif %}">Search</a></li>
          <li><a href="{{ url_for('donate_page') }}" class="pf-link {% if request.endpoint == 'donate_page' %}is-active{% endif %}">Donate</a></li>
          <li><a href="{{ url_for('about') }}" class="pf-link {% if request.endpoint == 'about' %}is-active{% endif %}">About</a></li>
          <li><a href="{{ url_for('developers') }}" class="pf-link {% if request.endpoint == 'developers' %}is-active{% endif %}">Developers</a></li>
        </ul>
      </nav>

      <!-- Desktop CTA -->
      <div class="hidden md:flex items-center gap-2">
        <a href="{{ url_for('login') }}" class="pf-btn pf-btn-ghost">Admin Login</a>
      </div>

      <!-- Mobile “Morph” Hamburger (SVG, modern) -->
      <button id="pf-menu-btn"
              type="button"
              aria-expanded="false"
              aria-controls="pf-mobile-drawer"
              class="md:hidden relative inline-grid place-items-center w-11 h-11 rounded-2xl
                     bg-white/10 border border-white/10 backdrop-blur shadow-lg overflow-hidden
                     focus:outline-none focus-visible:ring-2 focus-visible:ring-white/70 group"
              aria-label="Open menu">
        <!-- soft ripple origin -->
        <span class="pf-press-ring absolute inset-0 rounded-2xl pointer-events-none"></span>
        <!-- SVG icon that morphs to X -->
        <svg class="w-6 h-6 text-white" viewBox="0 0 24 24" fill="none" stroke="currentColor"
             stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
          <!-- top -->
          <line class="pf-line pf-line-1" x1="5" y1="7" x2="19" y2="7"/>
          <!-- middle becomes a dot pulse -->
          <line class="pf-line pf-line-2" x1="5" y1="12" x2="19" y2="12"/>
          <!-- bottom -->
          <line class="pf-line pf-line-3" x1="5" y1="17" x2="19" y2="17"/>
          <!-- center dot (hidden at rest) -->
          <circle class="pf-dot" cx="12" cy="12" r="1.8" fill="currentColor" opacity="0"/>
        </svg>
      </button>
    </div>
  </div>
</header>

<!-- Overlay (MOBILE-ONLY) — starts BELOW header so it never covers it -->
<div id="pf-overlay"
     class="fixed left-0 right-0 bottom-0 top-[var(--pf-header-h,0px)]
            bg-black/70 opacity-0 pointer-events-none transition-[opacity,backdrop-filter] duration-700 ease-out
            z-[1150] md:hidden"
     aria-hidden="true"></div>

<!-- Mobile Drawer (anchored BELOW header) -->
<aside id="pf-mobile-drawer"
       role="dialog" aria-modal="true" aria-labelledby="pf-mobile-title" tabindex="-1"
       class="fixed left-0 right-0 top-[var(--pf-header-h,0px)] opacity-0 pointer-events-none -translate-y-6
              z-[1190]  /* < header (1300), > overlay (1150) */
              text-white border-b border-blue-400 shadow-2xl rounded-b-2xl overflow-hidden
              transition-[transform,opacity] duration-700 ease-out will-change-transform md:hidden">
  <!-- Animated gradient background -->
  <div class="pf-gradient absolute inset-0 -z-10" aria-hidden="true"></div>

  <nav class="px-4 py-5" aria-label="Mobile Primary">
    <h2 id="pf-mobile-title" class="sr-only">Main Menu</h2>
    <ul class="flex flex-col gap-2">
      <li><a href="{{ url_for('home') }}" class="pf-mobile-item {% if request.endpoint == 'home' %}is-active{% endif %} pf-card"> <span class="pf-type">Home</span><span class="pf-sheen"></span></a></li>
      <li><a href="{{ url_for('register') }}" class="pf-mobile-item {% if request.endpoint == 'register' %}is-active{% endif %} pf-card"> <span class="pf-type">Register</span><span class="pf-sheen"></span></a></li>
      <li><a href="{{ url_for('search') }}" class="pf-mobile-item {% if request.endpoint == 'search' %}is-active{% endif %} pf-card"> <span class="pf-type">Search</span><span class="pf-sheen"></span></a></li>
      <li><a href="{{ url_for('donate_page') }}" class="pf-mobile-item {% if request.endpoint == 'donate_page' %}is-active{% endif %} pf-card"> <span class="pf-type">Donate</span><span class="pf-sheen"></span></a></li>
      <li><a href="{{ url_for('about') }}" class="pf-mobile-item {% if request.endpoint == 'about' %}is-active{% endif %} pf-card"> <span class="pf-type">About</span><span class="pf-sheen"></span></a></li>
      <li><a href="{{ url_for('developers') }}" class="pf-mobile-item {% if request.endpoint == 'developers' %}is-active{% endif %} pf-card"> <span class="pf-type">Developers</span><span class="pf-sheen"></span></a></li>
    </ul>

    <div class="mt-4 border-t border-white/25 pt-4">
      <a href="{{ url_for('login') }}"
         class="pf-glass-btn relative inline-flex w-full items-center justify-center gap-2 overflow-hidden
                rounded-2xl px-5 py-3 text-center font-semibold tracking-wide
                bg-white/10 hover:bg-white/15 active:bg-white/20 border border-white/20 shadow-sm
                text-white transition-transform duration-400 ease-out backdrop-blur-[2px]">
        <span class="pf-type">Admin Login</span>
        <span class="pf-sheen"></span>
      </a>
    </div>
  </nav>
</aside>

<!-- ===== Styles ===== -->
<style>
/* Desktop links */
.pf-link{display:inline-flex;align-items:center;gap:.5rem;padding:.45rem .8rem;border-radius:.65rem;color:rgba(255,255,255,.9);font-weight:600;transition:color .2s ease,transform .2s ease,background .2s ease;}
.pf-link:hover{color:#fff;transform:translateY(-1px);background:rgba(255,255,255,.08);}
.pf-link.is-active{color:#fff;background:linear-gradient(to right,rgba(255,255,255,.10),rgba(255,255,255,.04));}

/* Buttons */
.pf-btn{display:inline-flex;align-items:center;gap:.5rem;border-radius:.75rem;padding:.55rem .95rem;font-weight:600;transition:transform .15s ease,background .2s ease,border-color .2s ease,color .2s ease;}
.pf-btn:active{transform:translateY(1px);}
.pf-btn-ghost{background:transparent;border:1px solid rgba(255,255,255,.25);color:#fff;}
.pf-btn-ghost:hover{background:rgba(255,255,255,.08);}

/* Title gradient animation */
@keyframes gradient-move{0%{background-position:0% 50%}50%{background-position:100% 50%}100%{background-position:0% 50%}}
.animate-gradient{background-size:200% 200%;animation:gradient-move 6s ease infinite}

/* Mobile cards + sheen */
.pf-card{
  position: relative; display:block; width:100%;
  border-radius: .9rem; padding:.8rem .9rem; font-weight:600;
  border:1px solid rgba(255,255,255,.22);
  background: rgba(255,255,255,.08);
  color:#fff; overflow:hidden;
  transition: transform .25s ease, background .25s ease, border-color .25s ease;
}
.pf-card:hover{ transform: translateY(-1px); background: rgba(255,255,255,.12); border-color: rgba(255,255,255,.32); }
.pf-card .pf-sheen{ position:absolute; inset:0; background:linear-gradient(120deg,transparent,rgba(255,255,255,0.75) 45%,transparent 60%); transform:translateX(-120%); transition:transform 1.1s cubic-bezier(0.22,1,0.36,1); }
.pf-card:hover .pf-sheen{ transform:translateX(120%); }

/* ===== Mobile only ===== */
@media (max-width:767.98px){
  /* Modern SVG hamburger */
  #pf-menu-btn svg{ transition: transform .3s ease; }
  #pf-menu-btn .pf-line{ transform-origin: 12px 12px; transition: transform 600ms cubic-bezier(0.16,1,0.3,1), opacity 300ms ease, stroke-dasharray .4s ease, stroke-dashoffset .4s ease; }
  #pf-menu-btn .pf-line-1{ stroke-dasharray: 14 40; }
  #pf-menu-btn .pf-line-2{ stroke-dasharray: 14 40; }
  #pf-menu-btn .pf-line-3{ stroke-dasharray: 14 40; }
  #pf-menu-btn .pf-dot{ transition: opacity .35s ease, transform .45s ease; transform-origin: 12px 12px; }

  /* opened -> X, middle dot pulse */
  #pf-menu-btn[aria-expanded="true"] .pf-line-1{ transform: translateY(5px) rotate(45deg); stroke-dasharray: 20 40; }
  #pf-menu-btn[aria-expanded="true"] .pf-line-2{ opacity:0; }
  #pf-menu-btn[aria-expanded="true"] .pf-line-3{ transform: translateY(-5px) rotate(-45deg); stroke-dasharray: 20 40; }
  #pf-menu-btn[aria-expanded="true"] .pf-dot{ opacity:1; transform: scale(1.4); }

  /* ripple */
  .pf-press-ring{background:radial-gradient(120px 120px at var(--x,50%) var(--y,50%),rgba(255,255,255,.22),transparent 42%);opacity:0;transition:opacity .35s ease;}
  #pf-menu-btn:active .pf-press-ring{opacity:1;}

  /* Drawer gradient */
  .pf-gradient{
    background-image:
      radial-gradient(1200px 600px at 0% -20%, rgba(59,130,246,0.55), transparent 60%),
      radial-gradient(900px 550px at 110% -10%, rgba(99,102,241,0.55), transparent 60%),
      linear-gradient(135deg, #2563eb, #1e40af 40%, #1f2a5a 80%);
    background-size: 200% 200%, 200% 200%, 200% 200%;
    animation: pf-grad-shift 16s ease-in-out infinite;
  }
  @keyframes pf-grad-shift{
    0%   {background-position: 0% 50%, 100% 50%,   0% 50%;}
    25%  {background-position: 20% 40%, 80%  30%,  50% 60%;}
    50%  {background-position: 60% 60%, 40%  70%, 100% 40%;}
    75%  {background-position: 80% 50%, 10%  40%,  50% 50%;}
    100% {background-position: 0% 50%, 100% 50%,   0% 50%;}
  }

  /* Open/close animation */
  @keyframes pf-panel-open-slow{
    0%{opacity:0;transform:translateY(-24px) scaleY(.98);clip-path:inset(0 0 100% 0 round 0 0 16px 16px);}
    60%{opacity:1;transform:translateY(4px) scaleY(1.01);clip-path:inset(0 0 0 0 round 0 0 16px 16px);}
    85%{transform:translateY(-1px) scaleY(1);}
    100%{opacity:1;transform:translateY(0) scaleY(1);clip-path:inset(0 0 0 0 round 0 0 16px 16px);}
  }
  @keyframes pf-panel-close-slow{
    0%{opacity:1;transform:translateY(0) scaleY(1);clip-path:inset(0 0 0 0 round 0 0 16px 16px);}
    40%{transform:translateY(-4px) scaleY(.995);}
    100%{opacity:0;transform:translateY(-14px) scaleY(.98);clip-path:inset(0 0 100% 0 round 0 0 16px 16px);}
  }
  #pf-mobile-drawer.pf-open{animation:pf-panel-open-slow 900ms cubic-bezier(0.16,1,0.3,1) both;}
  #pf-mobile-drawer.pf-closing{animation:pf-panel-close-slow 700ms cubic-bezier(0.4,0,0.2,1) both;}
  .pf-overlay-open{backdrop-filter: blur(4px);}

  /* Staggered items */
  #pf-mobile-drawer .pf-mobile-item{opacity:0;transform:translateY(-12px);transition:transform 520ms cubic-bezier(0.16,1,0.3,1),opacity 520ms cubic-bezier(0.16,1,0.3,1);}
  #pf-mobile-drawer .pf-item-show{opacity:1;transform:translateY(0);}

  /* Type-in text */
  .pf-type{display:inline-block;white-space:nowrap;}
  .pf-type[data-typing="true"]::after{content:"";display:inline-block;width:1px;height:1.1em;vertical-align:-0.15em;background:currentColor;margin-left:2px;animation:pf-caret 900ms steps(1,end) infinite;}
  @keyframes pf-caret{50%{opacity:0}}
}
</style>

<!-- ===== Script ===== -->
<script>
document.addEventListener('DOMContentLoaded',()=>{
  const header  = document.getElementById('pf-header');
  const btn     = document.getElementById('pf-menu-btn');
  const drawer  = document.getElementById('pf-mobile-drawer');
  const overlay = document.getElementById('pf-overlay');

  /* 1) Set CSS var for header height (so overlay & drawer start BELOW header) */
  function setHeaderHeightVar(){
    const h = header ? Math.round(header.getBoundingClientRect().height) : 0;
    document.documentElement.style.setProperty('--pf-header-h', h + 'px');
    // Max height for drawer body
    drawer.style.maxHeight = `calc(100vh - ${h}px - env(safe-area-inset-bottom,0px))`;
  }
  setHeaderHeightVar();
  window.addEventListener('resize', setHeaderHeightVar);

  /* 2) Prevent any external spacer from pushing content by ensuring first block isn't offset by drawer */
  function firstContentEl(){
    const kids = Array.from(document.body.children)
      .filter(el => !['SCRIPT','STYLE','LINK'].includes(el.tagName)
                 && el !== header && el !== overlay && el !== drawer);
    return kids[0] || null;
  }
  function neutralizeGap(){
    const first = firstContentEl();
    if (!first) return;
    // Ensure no margin-top equal to drawer height is added elsewhere
    first.style.marginTop = '0';
  }
  neutralizeGap();
  window.addEventListener('resize', neutralizeGap);

  /* Typewriter */
  const typeSpans = () => Array.from(drawer.querySelectorAll('.pf-type'));
  const prefersReduced = window.matchMedia('(prefers-reduced-motion: reduce)').matches;
  function captureOriginalText(){ typeSpans().forEach(s=>{ if(!s.dataset.text) s.dataset.text = s.textContent.trim(); }); }
  function typeText(span,text,charDelay,startDelay=0){
    if (prefersReduced || !text){ span.textContent = text || ''; span.dataset.typing="false"; return; }
    span.textContent=''; span.dataset.typing="true";
    let i=0; const tick=()=>{ if(i<text.length){ span.textContent+=text.charAt(i++); setTimeout(tick,charDelay); } else { span.dataset.typing="false"; } };
    setTimeout(tick,startDelay);
  }
  function typeAllLabels(){ typeSpans().forEach((s,i)=>typeText(s,s.dataset.text||s.textContent.trim(),22,i*140)); }
  function restoreLabels(){ typeSpans().forEach(s=>{ s.textContent=s.dataset.text||s.textContent.trim(); s.dataset.typing="false"; }); }
  captureOriginalText();

  /* Stagger */
  function animateItemsIn(){
    [...drawer.querySelectorAll('.pf-mobile-item')].forEach((el,i)=>{
      el.style.transitionDelay=(i*120)+'ms';
      requestAnimationFrame(()=>requestAnimationFrame(()=>el.classList.add('pf-item-show')));
    });
  }
  function animateItemsOut(){
    [...drawer.querySelectorAll('.pf-mobile-item')].reverse().forEach((el,i)=>{
      el.style.transitionDelay=(i*90)+'ms';
      el.classList.remove('pf-item-show');
    });
  }

  /* Open/Close */
  function openDrawer(){
    drawer.classList.remove('pf-closing'); void drawer.offsetWidth;
    drawer.classList.add('pf-open');
    drawer.classList.remove('pointer-events-none','opacity-0','-translate-y-6');
    drawer.classList.add('opacity-100','translate-y-0');

    overlay.classList.remove('pointer-events-none');
    overlay.classList.add('opacity-100','pf-overlay-open');

    animateItemsIn();
    typeAllLabels();

    btn.setAttribute('aria-expanded','true');
    document.body.style.overflow='hidden';
  }
  function closeDrawer(){
    animateItemsOut();
    drawer.classList.remove('pf-open'); void drawer.offsetWidth;
    drawer.classList.add('pf-closing');
    drawer.classList.remove('opacity-100','translate-y-0');
    drawer.classList.add('opacity-0','-translate-y-6');
    setTimeout(()=>drawer.classList.add('pointer-events-none'),750);

    overlay.classList.remove('opacity-100','pf-overlay-open');
    overlay.classList.add('pointer-events-none');

    restoreLabels();

    btn.setAttribute('aria-expanded','false');
    document.body.style.overflow='';
  }

  btn.addEventListener('click',()=> (btn.getAttribute('aria-expanded')==='true') ? closeDrawer() : openDrawer());
  overlay.addEventListener('click',closeDrawer);
  drawer.addEventListener('click',e=>{ if(e.target.closest('a')) closeDrawer(); });

  /* Ripple origin for hamburger */
  function setRing(e){
    const rect = btn.getBoundingClientRect();
    const x = (e.touches? e.touches[0].clientX : e.clientX) - rect.left;
    const y = (e.touches? e.touches[0].clientY : e.clientY) - rect.top;
    btn.style.setProperty('--x', x+'px'); btn.style.setProperty('--y', y+'px');
  }
  ['pointerdown','touchstart','mousemove'].forEach(ev=>btn.addEventListener(ev,setRing,{passive:true}));
});
</script>
<!-- ================= END HEADER ================= -->
