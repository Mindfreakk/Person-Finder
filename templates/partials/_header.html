<script>(function(){try{var d=document.documentElement;d.classList.add('pf-nav-prep','pf-admin-prep');}catch(e){}})();</script>
<!-- ================= HEADER (RESPONSIVE, FIXED) ================= -->
<header id="pf-header"
        class="fixed top-0 inset-x-0 z-[1300]
               supports-[backdrop-filter]:backdrop-blur
               bg-white/10 dark:bg-slate-900/40 border-b border-white/10">
  <div class="mx-auto max-w-7xl px-4 sm:px-6">
    <div class="h-16 md:h-20 flex items-center justify-between gap-3">
      <!-- Brand -->
      <a href="{{ url_for('home') }}" class="flex items-center gap-3 min-w-0" aria-label="Go to homepage">
        <img alt="Logo" class="w-11 h-11 md:w-12 md:h-12 rounded-xl shadow-lg shrink-0"
             src="{{ url_for('static', filename='images/elderly.jpeg') }}" />
        <div class="min-w-0 leading-tight">
          <div class="text-xl md:text-2xl font-extrabold tracking-tight
                      bg-gradient-to-r from-blue-500 via-purple-500 to-pink-500 bg-clip-text text-transparent animate-gradient truncate">
            PersonFinder
          </div>
          <p class="text-[12px] md:text-sm text-white/85">Reunite Loved Ones</p>
        </div>
      </a>

      <!-- Desktop Nav -->
      <nav class="hidden md:flex flex-1 justify-center pl-12 lg:pl-20">
        <ul id="pf-desktop-nav" class="flex items-center gap-2 lg:gap-4 relative translate-x-4">
          <!-- Animated underline -->
          <span id="pf-active-underline"
                class="absolute -bottom-2 h-[2px] rounded-full"
                style="left:0;width:0;"></span>

          <li><a href="{{ url_for('home') }}" class="pf-link {% if request.endpoint == 'home' %}is-active{% endif %}"><span class="pf-link-label">Home</span></a></li>
          <li><a href="{{ url_for('register') }}" class="pf-link {% if request.endpoint == 'register' %}is-active{% endif %}"><span class="pf-link-label">Register</span></a></li>
          <li><a href="{{ url_for('search') }}" class="pf-link {% if request.endpoint == 'search' %}is-active{% endif %}"><span class="pf-link-label">Search</span></a></li>
          <li><a href="{{ url_for('donate_page') }}" class="pf-link {% if request.endpoint == 'donate_page' %}is-active{% endif %}"><span class="pf-link-label">Donate</span></a></li>
          <li><a href="{{ url_for('about') }}" class="pf-link {% if request.endpoint == 'about' %}is-active{% endif %}"><span class="pf-link-label">About</span></a></li>
          <li><a href="{{ url_for('developers') }}" class="pf-link {% if request.endpoint == 'developers' %}is-active{% endif %}"><span class="pf-link-label">Developers</span></a></li>
        </ul>
      </nav>

      <!-- Desktop CTA -->
      <div class="hidden md:flex items-center gap-2">
        <a href="{{ url_for('login') }}"
           class="pf-btn pf-btn-ghost pf-admin-cta{% if request.endpoint in ('login','admin_dashboard') %} is-active{% endif %}"
           {% if request.endpoint in ('login','admin_dashboard') %} aria-current="page"{% endif %}>
          <span class="pf-type">Admin Login</span>
          <span class="pf-cta-sheen" aria-hidden="true"></span>
          <span class="pf-cta-pulse" aria-hidden="true"></span>
        </a>
      </div>

      <!-- Mobile “Chevron/Arrow” Hamburger -->
      <button id="pf-menu-btn"
              type="button"
              aria-expanded="false"
              aria-controls="pf-mobile-drawer"
              class="md:hidden relative inline-grid place-items-center w-11 h-11 rounded-2xl
                     bg-white/10 border border-white/10 backdrop-blur shadow-lg overflow-hidden
                     focus:outline-none focus-visible:ring-2 focus-visible:ring-white/70 group"
              aria-label="Open menu">
        <span class="pf-press-ring absolute inset-0 rounded-2xl pointer-events-none"></span>
        <!-- 3 lines + dot, morphs to chevron/arrow on open -->
        <svg class="w-6 h-6 text-white" viewBox="0 0 24 24" fill="none" stroke="currentColor"
             stroke-width="2.2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
          <line class="pf-line pf-line-1" x1="4.5" y1="7" x2="19.5" y2="7"/>
          <line class="pf-line pf-line-2" x1="7" y1="12" x2="17" y2="12"/>
          <line class="pf-line pf-line-3" x1="4.5" y1="17" x2="19.5" y2="17"/>
          <circle class="pf-dot" cx="12" cy="12" r="1.7" fill="currentColor" opacity="0"/>
        </svg>
      </button>
    </div>
  </div>
</header>

<!-- Overlay (MOBILE-ONLY) -->
<div id="pf-overlay"
     class="fixed left-0 right-0 bottom-0 top-[var(--pf-header-h,0px)]
            bg-black/70 opacity-0 pointer-events-none transition-[opacity,backdrop-filter] duration-700 ease-out
            z-[1150] md:hidden"
     aria-hidden="true"></div>

<!-- Mobile Drawer -->
<aside id="pf-mobile-drawer"
       role="dialog" aria-modal="true" aria-labelledby="pf-mobile-title" tabindex="-1"
       class="fixed left-0 right-0 top-[var(--pf-header-h,0px)] opacity-0 pointer-events-none -translate-y-6
              z-[1190] text-white border-b border-blue-400 shadow-2xl rounded-b-2xl overflow-hidden
              transition-[transform,opacity] duration-700 ease-out will-change-transform md:hidden">
  <div class="pf-gradient absolute inset-0 -z-10" aria-hidden="true"></div>
  <nav class="px-4 py-5" aria-label="Mobile Primary">
    <h2 id="pf-mobile-title" class="sr-only">Main Menu</h2>
    <ul class="flex flex-col gap-2">
      <li><a href="{{ url_for('home') }}" class="pf-mobile-item {% if request.endpoint == 'home' %}is-active{% endif %} pf-card"{% if request.endpoint == 'home' %} aria-current="page"{% endif %}><span class="pf-type">Home</span></a></li>
      <li><a href="{{ url_for('register') }}" class="pf-mobile-item {% if request.endpoint == 'register' %}is-active{% endif %} pf-card"{% if request.endpoint == 'register' %} aria-current="page"{% endif %}><span class="pf-type">Register</span></a></li>
      <li><a href="{{ url_for('search') }}" class="pf-mobile-item {% if request.endpoint == 'search' %}is-active{% endif %} pf-card"{% if request.endpoint == 'search' %} aria-current="page"{% endif %}><span class="pf-type">Search</span></a></li>
      <li><a href="{{ url_for('donate_page') }}" class="pf-mobile-item {% if request.endpoint == 'donate_page' %}is-active{% endif %} pf-card"{% if request.endpoint == 'donate_page' %} aria-current="page"{% endif %}><span class="pf-type">Donate</span></a></li>
      <li><a href="{{ url_for('about') }}" class="pf-mobile-item {% if request.endpoint == 'about' %}is-active{% endif %} pf-card"{% if request.endpoint == 'about' %} aria-current="page"{% endif %}><span class="pf-type">About</span></a></li>
      <li><a href="{{ url_for('developers') }}" class="pf-mobile-item {% if request.endpoint == 'developers' %}is-active{% endif %} pf-card"{% if request.endpoint == 'developers' %} aria-current="page"{% endif %}><span class="pf-type">Developers</span></a></li>
    </ul>

    <div class="mt-4 border-t border-white/25 pt-4">
      <!-- Admin button -->
      <a id="pf-admin-mobile"
         href="{{ url_for('login') }}"
         class="pf-glass-btn{% if request.endpoint in ('login','admin_dashboard') %} is-active{% endif %} relative inline-flex w-full items-center justify-center gap-2 overflow-hidden
                rounded-2xl px-5 py-3 text-center font-semibold tracking-wide
                bg-white/10 hover:bg-white/15 active:bg-white/20 border border-white/20 shadow-sm
                text-white transition-transform duration-400 ease-out backdrop-blur-[2px]"
         {% if request.endpoint in ('login','admin_dashboard') %} aria-current="page"{% endif %}>
        <span class="pf-type">Admin Login</span>
      </a>
    </div>
  </nav>
</aside>

<!-- CSS -->
 
<style>
/* Desktop links (base) */
.pf-link{
  position: relative;
  display:inline-flex;align-items:center;gap:.5rem;
  padding:.45rem .9rem;border-radius:.65rem;
  color:rgba(255,255,255,.9);font-weight:600;
  transition:color .35s ease,transform .35s ease,background .35s ease, box-shadow .35s ease, opacity .9s, transform .9s;
  overflow: hidden;
}
.pf-link:hover{color:#fff;transform:translateY(-1px);background:rgba(255,255,255,.08);} 

/* ===== Shimmer effect (shared; slightly slowed) ===== */
@keyframes pf-sheen-scan{0%{transform:translateX(-130%)}100%{transform:translateX(130%)}}

/* Pulse for “live” dot — make sure it’s global */
@keyframes pf-live-pulse{
  0%{box-shadow:0 0 0 0 rgba(255,255,255,.55)}
  70%{box-shadow:0 0 0 10px rgba(255,255,255,0)}
  100%{box-shadow:0 0 0 0 rgba(255,255,255,0)}
}

.pf-link::after,
.pf-admin-cta::after,
.pf-mobile-item::after,
.pf-glass-btn::after{
  content:"";
  position:absolute;
  inset:0;
  background: linear-gradient(115deg, transparent 35%, rgba(255,255,255,.55) 50%, transparent 65%);
  transform: translateX(-130%);
  pointer-events:none;
  z-index: 0; /* shimmer film sits at 0 */
}

/* hover shimmer for desktop links (slower) */
.pf-link:hover::after{ animation: pf-sheen-scan 1.6s cubic-bezier(.22,1,.36,1); }

/* one-shot shimmer (desktop + mobile) — slowed from 1.1s → 1.3s */
.pf-link.pf-scan-once::after,
.pf-admin-cta.pf-scan-once::after,
.pf-mobile-item.pf-scan-once::after,
.pf-glass-btn.pf-scan-once::after{
  animation: pf-sheen-scan 1.3s cubic-bezier(.22,1,.36,1) var(--scan-delay,0ms) 1 both;
}

/* Active link (desktop) */
.pf-link.is-active{color:#fff;background:linear-gradient(to right,rgba(255,255,255,.10),rgba(255,255,255,.04));}

/* Buttons (base) */
.pf-btn{display:inline-flex;align-items:center;gap:.5rem;border-radius:.75rem;padding:.55rem .95rem;font-weight:600;transition:transform .2s ease,background .25s ease,border-color .25s ease,color .25s ease;}
.pf-btn:active{transform:translateY(1px);} 
.pf-btn-ghost{background:transparent;border:1px solid rgba(255,255,255,.25);color:#fff;}
.pf-btn-ghost:hover{background:rgba(255,255,255,.08);} 

/* Title gradient animation */
@keyframes gradient-move{0%{background-position:0% 50%}50%{background-position:100% 50%}100%{background-position:0% 50%}}
.animate-gradient{background-size:200% 200%;animation:gradient-move 6s ease infinite}

/* ===== DESKTOP-ONLY ENHANCEMENTS ===== */
@media (min-width: 768px){
  html.pf-nav-prep #pf-desktop-nav .pf-link { opacity: 0; transform: translateY(22px); }
  html.pf-nav-animate #pf-desktop-nav .pf-link {
    opacity: 1; transform: translateY(0);
    transition:
      opacity 1.2s cubic-bezier(.22,1,.36,1),
      transform 1.2s cubic-bezier(.22,1,.36,1),
      color .35s ease, box-shadow .35s ease, background .35s ease;
  }

  /* Underline: smooth & glowy */
  #pf-active-underline{
    background: linear-gradient(90deg, rgba(255,255,255,.95), rgba(255,255,255,.55));
    box-shadow: 0 0 18px rgba(255,255,255,.4);
    transition: left .8s cubic-bezier(.22,1,.36,1), width .8s cubic-bezier(.22,1,.36,1);
  }

  /* Admin CTA: slide in from right + shimmer on appear */
  .pf-admin-cta{
    position: relative; overflow: hidden;
    transform: translateX(0); opacity: 1;
    transition: transform .8s cubic-bezier(.22,1,.36,1), opacity .8s cubic-bezier(.22,1,.36,1);
  }
  .pf-admin-prep .pf-admin-cta{ transform: translateX(32px); opacity: 0; }
  .pf-admin-in   .pf-admin-cta{ transform: translateX(0);    opacity: 1; }

  .pf-admin-cta .pf-cta-sheen{
    position:absolute; inset:0;
    background: linear-gradient(115deg, transparent 35%, rgba(255,255,255,.5) 50%, transparent 65%);
    transform: translateX(-130%); pointer-events:none;
    transition: transform 1.6s cubic-bezier(.22,1,.36,1);
    z-index: 0; /* keep sheen below content and live bar */
  }
  .pf-admin-cta:hover .pf-cta-sheen{ transform: translateX(130%); }

  .pf-admin-cta .pf-cta-pulse{
    position:absolute; inset:-2px; border-radius: inherit; pointer-events:none;
    box-shadow: 0 0 0 0 rgba(255,255,255,.18);
    animation: pf-cta-pulse 3s ease-out infinite;
    z-index: 0;
  }
  @keyframes pf-cta-pulse{
    0%   { box-shadow: 0 0 0 0 rgba(255,255,255,.18); }
    70%  { box-shadow: 0 0 0 12px rgba(255,255,255,0); }
    100% { box-shadow: 0 0 0 0 rgba(255,255,255,0); }
  }

  /* ===== Desktop Nav Links — active/live gradient bar + dot ===== */
  #pf-desktop-nav .pf-link.is-active,
  #pf-desktop-nav .pf-link[aria-current="page"] {
    background: rgba(255,255,255,0.08);
    box-shadow: 0 0 10px rgba(255,255,255,0.15);
    position: relative;
    overflow: hidden;
  }

  /* Left gradient bar */
  #pf-desktop-nav .pf-link.is-active::before,
  #pf-desktop-nav .pf-link[aria-current="page"]::before {
    content: "";
    position: absolute;
    left: 0;
    top: 6px;
    bottom: 6px;
    width: 4px;
    border-radius: 4px;
    background: linear-gradient(180deg, #60a5fa, #a78bfa, #f472b6);
    box-shadow: 0 0 10px rgba(255,255,255,0.35);
    z-index: 1;
  }

  /* Pulsing dot after label */
  #pf-desktop-nav .pf-link.is-active .pf-link-label::after,
  #pf-desktop-nav .pf-link[aria-current="page"] .pf-link-label::after {
    content: "";
    display: inline-block;
    width: 6px;
    height: 6px;
    margin-left: 8px;
    border-radius: 9999px;
    background: radial-gradient(circle, #ffffff 45%, rgba(255,255,255,0.25) 85%);
    opacity: 0.95;
    vertical-align: middle;
    animation: pf-live-pulse 1.8s ease-out infinite;
    box-shadow: 0 0 8px rgba(255,255,255,0.4);
    position: relative;
    z-index: 2;
  }

  /* Hover refinement */
  #pf-desktop-nav .pf-link.is-active:hover,
  #pf-desktop-nav .pf-link[aria-current="page"]:hover {
    background: rgba(255,255,255,0.12);
    transform: translateY(-1px);
  }

  /* ===== Desktop Nav Links — active/live dot only (legacy fallback) ===== */
  #pf-desktop-nav .pf-link.is-active .pf-link-label::after,
  #pf-desktop-nav .pf-link[aria-current="page"] .pf-link-label::after {
    content: "";
    display: inline-block;
    width: 6px;
    height: 6px;
    margin-left: 8px;
    border-radius: 9999px;
    background: radial-gradient(circle, #ffffff 45%, rgba(255,255,255,0.25) 85%);
    opacity: 0.95;
    vertical-align: middle;
    animation: pf-live-pulse 1.8s ease-out infinite;
    box-shadow: 0 0 8px rgba(255,255,255,0.4);
    position: relative;
    z-index: 2; /* keep above shimmer film */
  }

  /* Ensure CTA text stays above decorations */
  .pf-admin-cta > span:first-child,
  .pf-admin-cta .pf-type{ position: relative; z-index: 2; }

  @media (prefers-reduced-motion: reduce){
    #pf-desktop-nav.pf-prep .pf-link,
    #pf-desktop-nav.pf-animate-in .pf-link { transition: none !important; opacity: 1 !important; transform: none !important; }
    #pf-active-underline{ transition: none !important; }
    .pf-admin-cta,
    .pf-admin-prep .pf-admin-cta,
    .pf-admin-in .pf-admin-cta{ transition: none !important; transform: none !important; opacity: 1 !important; }
    .pf-admin-cta::after,
    .pf-admin-cta .pf-cta-sheen,
    .pf-link::after,
    .pf-mobile-item::after,
    .pf-glass-btn::after{ animation: none !important; }
  }
}

/* ===== Desktop Admin CTA — active/live state ===== */
/* Works whether you added .pf-type or still have a plain <span> label */

/* Left gradient bar like active nav links */
.pf-admin-cta.is-active::before,
.pf-admin-cta[aria-current="page"]::before,
.pf-admin-cta:active::before{
  content:"";
  position:absolute; left:0; top:6px; bottom:6px; width:4px;
  border-radius:4px;
  background: linear-gradient(180deg,#60a5fa,#a78bfa,#f472b6);
  box-shadow: 0 0 10px rgba(255,255,255,.35);
  z-index:1; /* above sheen (0), below text (2) */
}

/* Pulsing dot AFTER the text label */
.pf-admin-cta.is-active > span:first-child::after,
.pf-admin-cta[aria-current="page"] > span:first-child::after,
.pf-admin-cta.is-active .pf-type::after,
.pf-admin-cta[aria-current="page"] .pf-type::after,
.pf-admin-cta:active > span:first-child::after,
.pf-admin-cta:active .pf-type::after{
  content:"";
  display:inline-block; width:7px; height:7px; margin-left:8px; border-radius:9999px;
  background: radial-gradient(circle, #ffffff 45%, rgba(255,255,255,0.25) 85%);
  opacity:.95; vertical-align:middle;
  animation: pf-live-pulse 1.8s ease-out infinite;
  box-shadow: 0 0 8px rgba(255,255,255,0.4);
  position: relative; z-index: 2; /* keep dot above sheen */
}

/* Slight background lift while active/pressed */
.pf-admin-cta.is-active,
.pf-admin-cta[aria-current="page"],
.pf-admin-cta:active{
  background: rgba(255,255,255,0.15);
  box-shadow: 0 0 12px rgba(255,255,255,0.2);
}


/* ===== Mobile-only ===== */
@media (max-width:767.98px){
  /* Chevron/Arrow morph */
  #pf-menu-btn svg{ transition: transform .3s ease; }
  #pf-menu-btn .pf-line{ transform-origin: 12px 12px; transition: transform 600ms cubic-bezier(0.16,1,0.3,1), opacity 320ms ease, stroke-dasharray .4s ease, stroke-dashoffset .4s ease; }
  #pf-menu-btn .pf-line-1{ stroke-dasharray: 15 40; }
  #pf-menu-btn .pf-line-2{ stroke-dasharray: 10 40; }
  #pf-menu-btn .pf-line-3{ stroke-dasharray: 15 40; }
  #pf-menu-btn .pf-dot{ transition: opacity .35s ease, transform .45s ease; transform-origin: 12px 12px; }

  /* Closed vs Open morph */
  #pf-menu-btn[aria-expanded="true"] .pf-line-1{ transform: translate(2px,5px) rotate(35deg); stroke-dasharray: 20 40; }
  #pf-menu-btn[aria-expanded="true"] .pf-line-2{ opacity:0; transform: scaleX(0.5); }
  #pf-menu-btn[aria-expanded="true"] .pf-line-3{ transform: translate(2px,-5px) rotate(-35deg); stroke-dasharray: 20 40; }
  #pf-menu-btn[aria-expanded="true"] .pf-dot{ opacity:1; transform: translateX(4px) scale(1.35); }

  .pf-press-ring{background:radial-gradient(120px 120px at var(--x,50%) var(--y,50%),rgba(255,255,255,.22),transparent 42%);opacity:0;transition:opacity .35s ease;}
  #pf-menu-btn:active .pf-press-ring{opacity:1;}

  .pf-gradient{
    background-image:
      radial-gradient(1200px 600px at 0% -20%, rgba(59,130,246,0.55), transparent 60%),
      radial-gradient(900px 550px at 110% -10%, rgba(99,102,241,0.55), transparent 60%),
      linear-gradient(135deg, #2563eb, #1e40af 40%, #1f2a5a 80%);
    background-size: 200% 200%, 200% 200%, 200% 200%;
    animation: pf-grad-shift 16s ease-in-out infinite;
  }
  @keyframes pf-grad-shift{
    0%   {background-position: 0% 50%, 100% 50%,   0% 50%;}
    25%  {background-position: 20% 40%, 80%  30%,  50% 60%;}
    50%  {background-position: 60% 60%, 40%  70%, 100% 40%;}
    75%  {background-position: 80% 50%, 10%  40%,  50% 50%;}
    100% {background-position: 0% 50%, 100% 50%,   0% 50%;}
  }

  @keyframes pf-panel-open-slow{
    0%{opacity:0;transform:translateY(-24px) scaleY(.98);clip-path:inset(0 0 100% 0 round 0 0 16px 16px);}
    60%{opacity:1;transform:translateY(4px) scaleY(1.01);clip-path:inset(0 0 0 0 round 0 0 16px 16px);}
    85%{transform:translateY(-1px) scaleY(1);}
    100%{opacity:1;transform:translateY(0) scaleY(1);clip-path:inset(0 0 0 0 round 0 0 16px 16px);}
  }
  @keyframes pf-panel-close-slow{
    0%{opacity:1;transform:translateY(0) scaleY(1);clip-path:inset(0 0 0 0 round 0 0 16px 16px);}
    40%{transform:translateY(-4px) scaleY(.995);}
    100%{opacity:0;transform:translateY(-14px) scaleY(.98);clip-path:inset(0 0 100% 0 round 0 0 16px 16px);}
  }
  #pf-mobile-drawer.pf-open{animation:pf-panel-open-slow 900ms cubic-bezier(0.16,1,0.3,1) both;}
  #pf-mobile-drawer.pf-closing{animation:pf-panel-close-slow 700ms cubic-bezier(0.4,0,0.2,1) both;}

  /* MOBILE NAV LINK CELL (no overlap, clipped shimmer) */
  #pf-mobile-drawer .pf-mobile-item{
    display:block;
    width:100%;
    position:relative;
    z-index:0;
    overflow:hidden;              /* clip shimmer film to link */
    contain:paint;                /* prevent shimmer “leak” */
    border-radius:14px;
    padding:.9rem 1rem;
    background:rgba(255,255,255,.06);
    opacity:0;
    transform:translateY(-12px);
    transition:
      transform 520ms cubic-bezier(0.16,1,0.3,1),
      opacity   520ms cubic-bezier(0.16,1,0.3,1);
    will-change:transform,opacity;
  }
  #pf-mobile-drawer .pf-item-show{opacity:1;transform:translateY(0);}
  #pf-mobile-drawer .pf-mobile-item .pf-type{position:relative;z-index:1;}

  /* ACTIVE (selected) mobile nav: live bar + pulsing dot */
  #pf-mobile-drawer .pf-mobile-item.is-active{
    background:rgba(255,255,255,.12);
  }
  #pf-mobile-drawer .pf-mobile-item.is-active::before{
    content:"";
    position:absolute; left:0; top:8px; bottom:8px; width:4px;
    border-radius:4px;
    background: linear-gradient(180deg,#60a5fa,#a78bfa,#f472b6);
    box-shadow: 0 0 10px rgba(255,255,255,.35);
    z-index:1;
  }
  #pf-mobile-drawer .pf-mobile-item.is-active .pf-type::after{
    content:"";
    display:inline-block; width:6px; height:6px; margin-left:8px; border-radius:9999px;
    background:#fff; opacity:.9;
    animation: pf-live-pulse 1.8s ease-out infinite;
    vertical-align:middle;
  }
  @keyframes pf-live-pulse{
    0%{box-shadow:0 0 0 0 rgba(255,255,255,.55)}
    70%{box-shadow:0 0 0 10px rgba(255,255,255,0)}
    100%{box-shadow:0 0 0 0 rgba(255,255,255,0)}
  }

  /* Mobile Admin CTA: slide + shimmer (same timings as items) */
  #pf-mobile-drawer .pf-glass-btn{
    position:relative;
    overflow:hidden;   /* clip shimmer */
    contain:paint;
    opacity:0;
    transform:translateY(-12px);
    transition:
      transform 520ms cubic-bezier(0.16,1,0.3,1),
      opacity   520ms cubic-bezier(0.16,1,0.3,1);
    will-change:transform,opacity;
  }
  #pf-mobile-drawer .pf-glass-btn.pf-item-show{ opacity:1; transform:translateY(0); }

  /* --- Admin Login LIVE state — pressed OR active route --- */
  /* Left gradient bar (like active nav links) */
  #pf-mobile-drawer .pf-glass-btn:active::before,
  #pf-mobile-drawer .pf-glass-btn.is-pressed::before,
  #pf-mobile-drawer .pf-glass-btn.is-active::before{
    content:"";
    position:absolute; left:0; top:8px; bottom:8px; width:4px;
    border-radius:4px;
    background: linear-gradient(180deg,#60a5fa,#a78bfa,#f472b6);
    box-shadow: 0 0 10px rgba(255,255,255,.35);
    z-index:1;
  }

  /* Dot AFTER the text label */
  #pf-mobile-drawer .pf-glass-btn:active .pf-type::after,
  #pf-mobile-drawer .pf-glass-btn.is-pressed .pf-type::after,
  #pf-mobile-drawer .pf-glass-btn.is-active .pf-type::after{
    content:"";
    display:inline-block; width:7px; height:7px; margin-left:8px; border-radius:9999px;
    background: radial-gradient(circle, #ffffff 45%, rgba(255,255,255,0.25) 85%);
    opacity:.95; vertical-align:middle;
    animation: pf-live-pulse 1.8s ease-out infinite;
    box-shadow:0 0 8px rgba(255,255,255,0.4);
  }

  /* Slight background lift */
  #pf-mobile-drawer .pf-glass-btn:active,
  #pf-mobile-drawer .pf-glass-btn.is-pressed,
  #pf-mobile-drawer .pf-glass-btn.is-active{
    background: rgba(255,255,255,0.15);
    box-shadow: 0 0 12px rgba(255,255,255,0.2);
  }

  /* Overlay visible state */
  #pf-overlay.pf-visible{ opacity: 1; pointer-events: auto; backdrop-filter: blur(2px); }
}
</style>

<!-- ===== Script ===== -->
<script>
document.addEventListener('DOMContentLoaded',()=>{
  const header  = document.getElementById('pf-header');
  const btn     = document.getElementById('pf-menu-btn');
  const drawer  = document.getElementById('pf-mobile-drawer');
  const overlay = document.getElementById('pf-overlay');

  /* Header height var for overlay/drawer */
  function setHeaderHeightVar(){
    const h = header ? Math.round(header.getBoundingClientRect().height) : 0;
    document.documentElement.style.setProperty('--pf-header-h', h + 'px');
    if (drawer) drawer.style.maxHeight = `calc(100vh - ${h}px - env(safe-area-inset-bottom,0px))`;
  }
  setHeaderHeightVar();
  window.addEventListener('resize', setHeaderHeightVar);

  /* Mobile ripple origin for hamburger */
  function setRing(e){
    if(!btn) return;
    const rect = btn.getBoundingClientRect();
    const x = (e.touches? e.touches[0].clientX : e.clientX) - rect.left;
    const y = (e.touches? e.touches[0].clientY : e.clientY) - rect.top;
    btn.style.setProperty('--x', x+'px'); btn.style.setProperty('--y', y+'px');
  }
  ['pointerdown','touchstart','mousemove'].forEach(ev=>btn?.addEventListener(ev,setRing,{passive:true}));

  const prefersReduced = window.matchMedia('(prefers-reduced-motion: reduce)').matches;
  const mqDesktop = window.matchMedia('(min-width: 768px)');

  /* ===== Shimmer cleanup helper ===== */
  function cleanupShimmerOnce(el){
    if (!el) return;
    const handler = (e)=>{
      if (e.animationName !== 'pf-sheen-scan') return;
      el.classList.remove('pf-scan-once');
      el.removeEventListener('animationend', handler);
    };
    el.addEventListener('animationend', handler);
  }

  /* ========== DESKTOP: slide-up links + CTA slide-in with 0.5s offset and shimmer ========== */
  function initDesktopNav(){
    if (!mqDesktop.matches) return;

    const nav = document.getElementById('pf-desktop-nav');
    const underline = document.getElementById('pf-active-underline');
    const adminRoot = document.documentElement;
    const adminCta  = document.querySelector('.pf-admin-cta');
    if (!nav || !underline || !adminCta) return;

    const links = Array.from(nav.querySelectorAll('.pf-link'));

    // Reset states
    document.documentElement.classList.remove('pf-nav-animate');
    adminRoot.classList.remove('pf-admin-in');
    adminCta.classList.remove('pf-scan-once');

    if (prefersReduced){
      document.documentElement.classList.remove('pf-nav-prep','pf-admin-prep');
      document.documentElement.classList.add('pf-nav-animate','pf-admin-in');
      setupUnderline(nav, underline, links);
      return;
    }

    // Prepare + shimmer sequence
    const baseDelay = 220;
    links.forEach((a,i)=>{
      const delay = i * baseDelay;
      a.style.transitionDelay = `${delay}ms`;
      a.style.setProperty('--scan-delay', `${delay + 200}ms`);
      a.classList.add('pf-scan-once');
      cleanupShimmerOnce(a);
    });

    requestAnimationFrame(()=>{
      document.documentElement.classList.add('pf-nav-animate');
      document.documentElement.classList.remove('pf-nav-prep');
    });

    const appearDur = 1200;
    const lastDelay = (links.length - 1) * baseDelay;
    const adminRevealOffset = 500;
    const adminRevealAt = lastDelay + appearDur + adminRevealOffset;

    setTimeout(()=>{
      adminRoot.classList.add('pf-admin-in');
      adminRoot.classList.remove('pf-admin-prep');

      adminCta.classList.add('pf-scan-once');
      adminCta.style.setProperty('--scan-delay','60ms');
      cleanupShimmerOnce(adminCta);
    }, adminRevealAt);

    setupUnderline(nav, underline, links);
  }

  function setupUnderline(nav, underline, links){
    function moveUnderlineTo(a, animate=true){
      const rect = a.getBoundingClientRect();
      const parentRect = nav.getBoundingClientRect();
      const left = rect.left - parentRect.left;
      if (!animate){
        const prev = underline.style.transition;
        underline.style.transition = 'none';
        underline.style.left = left + 'px';
        underline.style.width = rect.width + 'px';
        underline.offsetHeight;
        underline.style.transition = prev || '';
        return;
      }
      underline.style.left = left + 'px';
      underline.style.width = rect.width + 'px';
    }
    const active = links.find(a => a.classList.contains('is-active')) || links[0];
    if (active) moveUnderlineTo(active, false);
    links.forEach(a=>{
      a.addEventListener('mouseenter', ()=> moveUnderlineTo(a, true));
      a.addEventListener('focus', ()=> moveUnderlineTo(a, true));
    });
    nav.addEventListener('mouseleave', ()=> active && moveUnderlineTo(active, true));
  }

  /* ========== MOBILE: Hamburger toggle logic + mobile slide→shimmer chain ========== */
  let lastFocusedEl = null;

  function isOpen(){ return btn?.getAttribute('aria-expanded') === 'true'; }

  function lockScroll(lock){
    document.documentElement.style.overflow = lock ? 'hidden' : '';
    document.body.style.overscrollBehavior = lock ? 'contain' : '';
    document.body.style.touchAction = lock ? 'none' : '';
  }

  function revealItems(stagger=90){
    const items = drawer?.querySelectorAll('.pf-mobile-item') || [];
    theSlideDur = 520;
    const slideDur = 520;
    const shimmerLag = 80;

    items.forEach((el,i)=>{
      const start = i * stagger;
      el.classList.remove('pf-item-show');
      setTimeout(()=> el.classList.add('pf-item-show'), start);

      el.classList.remove('pf-scan-once');
      el.style.setProperty('--scan-delay', `${start + slideDur + shimmerLag}ms`);
      el.classList.add('pf-scan-once');
      cleanupShimmerOnce(el);
    });

    const mCta = drawer.querySelector('#pf-admin-mobile.pf-glass-btn');
    if (mCta){
      const startCta = (items.length) ? items.length * stagger : 0;
      setTimeout(()=> mCta.classList.add('pf-item-show'), startCta);

      mCta.classList.remove('pf-scan-once');
      mCta.style.setProperty('--scan-delay', `${startCta + slideDur + shimmerLag}ms`);
      mCta.classList.add('pf-scan-once');
      cleanupShimmerOnce(mCta);
    }
  }

  function openMenu(){
    if (!btn || !drawer || !overlay) return;
    lastFocusedEl = document.activeElement;

    btn.setAttribute('aria-expanded','true');
    drawer.classList.remove('pf-closing');
    drawer.classList.add('pf-open');
    drawer.style.opacity = '1';
    drawer.style.pointerEvents = 'auto';

    overlay.classList.add('pf-visible');

    lockScroll(true);
    revealItems();

    const firstLink = drawer.querySelector('a[aria-current="page"], .pf-mobile-item.is-active') || drawer.querySelector('.pf-mobile-item');
    (firstLink || drawer.querySelector('a, button, [tabindex]:not([tabindex="-1"])'))?.focus();
  }

  function closeMenu(){
    if (!btn || !drawer || !overlay) return;

    btn.setAttribute('aria-expanded','false');
    drawer.classList.remove('pf-open');
    drawer.classList.add('pf-closing');

    overlay.classList.remove('pf-visible');

    drawer.querySelectorAll('.pf-mobile-item').forEach(el=>{
      el.classList.remove('pf-item-show','pf-scan-once');
      el.style.removeProperty('--scan-delay');
    });
    const mCta = drawer.querySelector('#pf-admin-mobile.pf-glass-btn');
    if (mCta){
      mCta.classList.remove('pf-item-show','pf-scan-once');
      mCta.style.removeProperty('--scan-delay');
    }

    const closeAfter = 700;
    setTimeout(()=>{
      drawer.style.opacity = '';
      drawer.style.pointerEvents = 'none';
      drawer.classList.remove('pf-closing');
    }, closeAfter);

    lockScroll(false);
    lastFocusedEl && lastFocusedEl.focus?.();
  }

  // --- Admin button: show "live" ONLY while actually pressed ---
  (function adminPressedOnly(){
    const adminBtn = document.getElementById('pf-admin-mobile');
    if (!adminBtn) return;

    const pressOn = () => adminBtn.classList.add('is-pressed');
    const pressOff = () => adminBtn.classList.remove('is-pressed');

    // Pointer (touch/mouse/stylus)
    adminBtn.addEventListener('pointerdown', pressOn, {passive:true});
    ['pointerup','pointercancel','pointerleave'].forEach(ev =>
      adminBtn.addEventListener(ev, pressOff, {passive:true})
    );

    // Keyboard (Space/Enter)
    adminBtn.addEventListener('keydown', (e)=>{
      if (e.key === ' ' || e.key === 'Enter') pressOn();
    });
    adminBtn.addEventListener('keyup', (e)=>{
      if (e.key === ' ' || e.key === 'Enter') pressOff();
    });

    adminBtn.addEventListener('blur', pressOff);

    // Ensure it's off after drawer closes
    const drawer = document.getElementById('pf-mobile-drawer');
    drawer?.addEventListener('animationend', ()=>{
      if (!document.getElementById('pf-menu-btn')?.matches('[aria-expanded="true"]')) pressOff();
    });
  })();

  // Events
  btn?.addEventListener('click', (e)=>{
    e.preventDefault();
    isOpen() ? closeMenu() : openMenu();
  });
  overlay?.addEventListener('click', closeMenu);
  document.addEventListener('keydown', (e)=>{ if (e.key === 'Escape' && isOpen()) closeMenu(); });

  // focus trap while open
  document.addEventListener('keydown', (e)=>{
    if (e.key !== 'Tab' || !isOpen()) return;
    const focusables = drawer.querySelectorAll('a, button, input, select, textarea, [tabindex]:not([tabindex="-1"])');
    if (!focusables.length) return;
    const first = focusables[0];
    const last  = focusables[focusables.length - 1];
    if (e.shiftKey && document.activeElement === first){ last.focus(); e.preventDefault(); }
    else if (!e.shiftKey && document.activeElement === last){ first.focus(); e.preventDefault(); }
  });

  // Close if switching to desktop; re-init desktop effects
  mqDesktop.addEventListener?.('change', (ev)=>{
    if (ev.matches && isOpen()) closeMenu();
    if (ev.matches) initDesktopNav();
  });

  // Init desktop behavior once
  initDesktopNav();

  // --- Fallback: mark Admin CTA as active on admin-like URLs (keeps live state on dashboard) ---
  (function ensureAdminLive(){
    const adminLikely = /\/admin(?:[_-]dashboard)?|\/dashboard(?:\/admin)?/i.test(location.pathname);
    if (!adminLikely) return;
    const desktopAdmin = document.querySelector('.pf-admin-cta');
    const mobileAdmin  = document.getElementById('pf-admin-mobile');
    desktopAdmin?.classList.add('is-active');
    desktopAdmin?.setAttribute('aria-current','page');
    mobileAdmin?.classList.add('is-active');
    mobileAdmin?.setAttribute('aria-current','page');
  })();
});
</script>
<!-- ================= END HEADER ================= -->
