{% extends "base.html" %}
{% block title %}Forgot / Reset Password - PersonFinder{% endblock %}

{% block content %}
<div class="flex min-h-screen justify-center items-center px-4 sm:px-6 lg:px-8">

  <!-- Reset Password Card -->
  <div class="bg-white/10 backdrop-blur-md shadow-xl rounded-2xl p-8 w-full max-w-md md:max-w-lg 
              border border-gray-700 transition-transform duration-300 transform hover:scale-105 animate-slideFadeIn">

    {% if token_valid %}
      <!-- Set New Password -->
      <h2 class="text-3xl sm:text-4xl font-extrabold text-white mb-4 text-center">
        Set New Admin Password
      </h2>
      <p class="text-gray-300 mb-4 text-sm text-center">
        Enter your new password below to reset your admin account.
      </p>

      <form method="POST" action="" class="space-y-5">
        <div>
          <label class="block text-sm font-medium text-gray-200">New Password</label>
          <input name="password" type="password" required
                 class="mt-1 block w-full px-4 py-2 rounded-xl bg-gray-800/60 border border-gray-600 
                        text-gray-100 focus:ring-2 focus:ring-blue-500"
                 placeholder="Enter new password">
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-200">Confirm Password</label>
          <input name="confirm_password" type="password" required
                 class="mt-1 block w-full px-4 py-2 rounded-xl bg-gray-800/60 border border-gray-600 
                        text-gray-100 focus:ring-2 focus:ring-blue-500"
                 placeholder="Confirm new password">
        </div>
        <div>
          <button type="submit" 
                  class="w-full py-2 px-4 rounded-xl bg-gradient-to-r from-blue-600 via-purple-600 to-pink-600 
                         text-white font-semibold shadow-lg hover:opacity-90 transition relative overflow-hidden login-gradient-btn">
            Update Password
          </button>
        </div>
      </form>

    {% else %}
      <!-- Request Reset Link -->
      <h2 class="text-3xl sm:text-4xl font-extrabold text-white mb-4 text-center">
        Reset Admin Password
      </h2>
      <p class="text-gray-300 mb-4 text-sm text-center">
        Enter your registered admin email below to receive a password reset link.
      </p>

      <form method="POST" action="{{ url_for('forgot_password') }}" class="space-y-5">
        <div>
          <label class="block text-sm font-medium text-gray-200">Admin Email</label>
          <input name="email" type="email" required
                 class="mt-1 block w-full px-4 py-2 rounded-xl bg-gray-800/60 border border-gray-600 
                        text-gray-100 focus:ring-2 focus:ring-blue-500"
                 placeholder="admin@example.com">
        </div>
        <div>
          <button type="submit" 
                  class="w-full py-2 px-4 rounded-xl bg-gradient-to-r from-blue-600 via-purple-600 to-pink-600 
                         text-white font-semibold shadow-lg hover:opacity-90 transition relative overflow-hidden login-gradient-btn">
            Send Reset Link
          </button>
        </div>
      </form>
    {% endif %}

    <!-- Back to Login -->
    <p class="mt-6 text-center text-gray-400 text-sm">
      Remembered your password? 
      <a href="{{ url_for('login') }}" class="text-blue-400 hover:text-blue-300 font-semibold">Login</a>
    </p>

    <!-- Flash Messages -->
    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        <div class="space-y-2 mt-4">
          {% for category, message in messages %}
            <div class="text-sm px-3 py-2 rounded-lg
                        {% if category == 'error' %} bg-red-500/20 text-red-300 border border-red-500/40
                        {% elif category == 'success' %} bg-green-500/20 text-green-300 border border-green-500/40
                        {% else %} bg-gray-500/20 text-gray-200 border border-gray-500/40 {% endif %}">
              {{ message }}
            </div>
          {% endfor %}
        </div>
      {% endif %}
    {% endwith %}
  </div>
</div>

<!-- Divider -->
<div class="relative w-full flex justify-center mt-[2cm] mb-[2cm]">
  <div class="h-px w-3/4 sm:w-2/3 lg:w-1/2 bg-gradient-to-r from-transparent via-gray-400/40 to-transparent"></div>
  <span class="absolute -top-3 bg-blue-900 text-gray-200 text-xs sm:text-sm px-3 py-1 rounded-full shadow-md tracking-wide">
    Security
  </span>
</div>

<!-- Info Box for Password Reset with Icon -->
<div class="info-box bg-indigo-900/40 border border-indigo-500/30 rounded-xl p-5 shadow-lg 
            max-w-2xl mx-auto text-center mb-16 animate-slide-in animate-pulse-slow">

  <!-- Icon -->
  <div class="flex justify-center mb-3">
    <svg xmlns="http://www.w3.org/2000/svg" 
         class="h-6 w-6 text-purple-400 animate-bounce" 
         fill="none" viewBox="0 0 24 24" stroke="currentColor">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
            d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
    </svg>
  </div>

  <!-- Text -->
  <p class="max-w-lg mx-auto text-center text-gray-300 text-sm sm:text-base leading-relaxed px-4">
    This page allows authorized administrators to 
    <span class="text-yellow-300 font-semibold">securely reset their password</span>.  
    Please provide the required verification details to confirm your identity.  
    For security reasons, reset links are time-limited and will expire if not used promptly.  
    <span class="text-green-300 font-medium">Do not share your reset credentials with anyone</span>.
  </p>
</div>

<!-- Styles -->

<style>
  @keyframes cardFlow {
    0% { opacity: 0; transform: translateY(40px) scale(0.95); }
    100% { opacity: 1; transform: translateY(0) scale(1); }
  }
  .animate-cardFlow {
    animation: cardFlow 0.9s ease-out forwards;
  }

<style>
  .login-gradient-btn::after {
    content: "";
    position: absolute;
    left: -60%;
    top: 0;
    width: 60%;
    height: 100%;
    background: linear-gradient(120deg, rgba(255,255,255,0.2), rgba(255,255,255,0.05), rgba(255,255,255,0.2));
    transform: skewX(-20deg);
    transition: left 0.9s ease;
  }
  .login-gradient-btn:hover::after { 
    left: 150%; 
  }

  @keyframes slideFadeIn {
    0% { opacity: 0; transform: translateY(30px); }
    100% { opacity: 1; transform: translateY(0); }
  }
  .animate-slideFadeIn { 
    animation: slideFadeIn 0.8s ease-out forwards; 
  }

  /* ðŸ”¹ Continuous pulse effect for info-box */
@keyframes pulseSlow {
  0%, 100% { transform: scale(1); }
  50% { transform: scale(1.03); }
}
.animate-pulse-slow {
  animation: pulseSlow 2.5s ease-in-out infinite;
}
</style>
{% endblock %}
