{% extends "base.html" %}

{% block title %}Privacy Policy - PersonFinder{% endblock %}

{% block content %}
<div class="flex flex-col items-center w-full px-4 sm:px-6 lg:px-8 py-8 space-y-6 animate-page-enter mt-20">


    <!-- Heading -->
    <header class="mb-6 text-center">
      <h1 class="text-2xl sm:text-3xl md:text-4xl font-extrabold text-white">Privacy Policy</h1>
      <p class="mx-auto text-[clamp(0.8rem,2.2vw,1rem)] leading-relaxed max-w-2xl mt-3 sm:mt-4 px-2 text-center">
        Your privacy matters. 
        <span class="text-green-400 font-semibold">Here we explain what we collect,</span> 
        how itâ€™s used, and how we protect your data.
      </p>
    </header>

    <!-- Divider -->
    <div class="relative w-full flex justify-center my-12 sm:my-16">
      <div class="h-px w-3/4 sm:w-2/3 lg:w-1/2 bg-gradient-to-r from-transparent via-gray-400/40 to-transparent"></div>
      <span class="absolute -top-3 bg-blue-900 text-gray-200 text-xs sm:text-sm px-3 py-1 rounded-full shadow-md tracking-wide">
        Details
      </span>
    </div>

    <!-- Accordion -->
    <div id="privacy-accordion" class="space-y-3">

      {% set sections = [
        {'title': '1. Information We Collect', 'content': '<p>When you use PersonFinder, we collect the following types of information:</p><ul class="list-disc ml-5 mt-2"><li><strong>Uploaded Photos:</strong> Images you submit to search for missing persons.</li><li><strong>Personal Data:</strong> Names, contact details and addresses of registered persons.</li><li><strong>Usage Data:</strong> Information about how you use the platform (searches, timestamps).</li></ul>'},
        {'title': '2. How We Use Your Information', 'content': '<p>We use your information to:</p><ul class="list-disc ml-5 mt-2"><li>Match uploaded photos with registered persons using AI.</li><li>Improve and personalize the service.</li><li>Send important updates or support messages.</li><li>Comply with legal obligations and prevent misuse.</li></ul>'},
        {'title': '3. Data Security', 'content': '<p>We protect your data with encryption, secure servers, and limited access. We regularly review our security measures.</p>'},
        {'title': '4. Sharing Your Information', 'content': '<p>We do not sell your personal data. We may share information with trusted service providers under confidentiality agreements or when required by law.</p>'},
        {'title': '5. Your Rights &amp; Choices', 'content': '<p>You can request access, corrections, or deletion of your data. Contact us for data removal or corrections.</p>'},
        {'title': '6. Cookies &amp; Tracking', 'content': '<p>We use cookies and similar technologies to improve the site and analyze usage. You can manage cookies via your browser.</p>'},
        {'title': '7. Changes to This Policy', 'content': '<p>We may update this Privacy Policy from time to time to reflect changes in our practices, legal requirements, or technology improvements. Significant updates will be highlighted on this page, and we encourage you to review the policy periodically. Continued use of PersonFinder after changes indicates your acceptance of the updated policy.</p>'}
      ] %}

      {% for section in sections %}
      <article class="accordion-item bg-transparent rounded-lg" id="section-{{ loop.index }}">
        <header class="w-full">
          <button
            type="button"
            id="accordion-header-{{ loop.index }}"
            class="accordion-header group flex items-start justify-between w-full px-4 py-4 sm:px-5 sm:py-5 text-left rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500"
            aria-expanded="false"
            aria-controls="section-content-{{ loop.index }}">
            <div class="flex-1 pr-4">
              <h3 class="text-white font-semibold text-base sm:text-lg">{{ section.title|safe }}</h3>
            </div>

            <svg class="accordion-icon w-5 h-5 text-white/80 transform transition-transform duration-300" viewBox="0 0 24 24" fill="none" stroke="currentColor" aria-hidden="true">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
            </svg>
          </button>
        </header>

        <div id="section-content-{{ loop.index }}" class="accordion-content max-h-0 overflow-hidden transition-[max-height] duration-300" role="region" aria-labelledby="accordion-header-{{ loop.index }}">
          <div class="accordion-inner px-4 pb-5 pt-3 sm:px-5 sm:pt-4 text-sm text-gray-400 leading-relaxed">
            {{ section.content|safe }}
          </div>
        </div>
      </article>
      {% endfor %}
    </div>
  </div>
</div>

<!-- ================= CONSENT POPUP ================= -->
<div id="consent-popup" class="fixed inset-0 bg-black/60 flex items-center justify-center z-50 hidden">
  <div class="bg-white max-w-md w-full rounded-2xl shadow-xl p-6 text-center animate-fadeIn">
    <h2 class="text-lg font-bold text-gray-800 mb-3">We value your privacy</h2>
    <p class="text-gray-600 text-sm mb-4">
      Please review and accept our 
      <a href="/privacy" class="text-blue-600 hover:underline">Privacy Policy</a> 
      and 
      <a href="/terms" class="text-blue-600 hover:underline">Terms of Service</a>.
    </p>
    <div class="flex gap-3 justify-center">
      <button id="reject-btn" class="px-4 py-2 rounded-lg bg-gray-300 hover:bg-gray-400 text-gray-800 font-medium">Reject</button>
      <button id="accept-btn" class="px-4 py-2 rounded-lg bg-green-500 hover:bg-green-600 text-white font-medium">Accept</button>
    </div>
  </div>
</div>

<style>
  /* Accordion styles */
  .accordion-header:hover { background-color: rgba(255,255,255,0.02); }
  .accordion-header:focus { box-shadow: 0 0 0 4px rgba(124,58,237,0.08); outline: none; border-radius: .5rem; }
  .accordion-content { transition: max-height 340ms ease; }
  .accordion-icon.rotate-180 { transform: rotate(180deg); }

  /* Popup animation */
  @keyframes fadeIn { from {opacity:0; transform:scale(0.95);} to {opacity:1; transform:scale(1);} }
  .animate-fadeIn { animation: fadeIn 0.25s ease-out; }
</style>

<script>
document.addEventListener('DOMContentLoaded', function () {
  // ----------------- ACCORDION -----------------
  const headers = document.querySelectorAll('.accordion-header');
  const contents = document.querySelectorAll('.accordion-content');

  contents.forEach(c => { c.style.maxHeight = '0px'; c.classList.remove('open'); });

  function closePanel(header, content) {
    content.style.maxHeight = '0px';
    content.classList.remove('open');
    header.setAttribute('aria-expanded', 'false');
    header.querySelector('.accordion-icon')?.classList.remove('rotate-180');
  }
  function openPanel(header, content) {
    const inner = content.querySelector('.accordion-inner') || content;
    content.style.maxHeight = inner.scrollHeight + 'px';
    content.classList.add('open');
    header.setAttribute('aria-expanded', 'true');
    header.querySelector('.accordion-icon')?.classList.add('rotate-180');
  }
  function closeAll() {
    headers.forEach(h => closePanel(h, h.closest('.accordion-item').querySelector('.accordion-content')));
  }

  headers.forEach(header => {
    header.addEventListener('click', function () {
      const content = header.closest('.accordion-item').querySelector('.accordion-content');
      if (content.classList.contains('open')) {
        closePanel(header, content);
      } else {
        closeAll();
        openPanel(header, content);
        if (window.innerWidth < 640) {
          setTimeout(() => header.scrollIntoView({ behavior: 'smooth', block: 'start' }), 140);
        }
      }
    });
  });

  window.addEventListener('resize', () => {
    contents.forEach(c => {
      if (c.classList.contains('open')) {
        const inner = c.querySelector('.accordion-inner') || c;
        c.style.maxHeight = inner.scrollHeight + 'px';
      }
    });
  });

  // ----------------- CONSENT POPUP -----------------
  const popup = document.getElementById('consent-popup');
  const acceptBtn = document.getElementById('accept-btn');
  const rejectBtn = document.getElementById('reject-btn');

  if (!localStorage.getItem('consentAccepted')) {
    popup.classList.remove('hidden');
  }

  acceptBtn.addEventListener('click', () => {
    localStorage.setItem('consentAccepted', 'true');
    popup.classList.add('hidden');
  });

  rejectBtn.addEventListener('click', () => {
    alert('You must accept the Privacy Policy & Terms to continue using this service.');
  });
});
</script>
{% endblock %}
