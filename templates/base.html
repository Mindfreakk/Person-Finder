<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>{% block title %}PersonFinder{% endblock %}</title>

  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- AOS Animation Library -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/aos/2.3.4/aos.css"/>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/aos/2.3.4/aos.js"></script>

  <!-- Custom CSS -->
  <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">

  <style>
    /* ðŸ”¹ Gradient underline for active nav links site-wide */
    nav a.active-link {
      position: relative;
    }

    nav a.active-link::after {
      content: "";
      position: absolute;
      left: 0;
      bottom: -4px;
      width: 100%;
      height: 3px;
      background: linear-gradient(to right, #ec4899, #a855f7);
      border-radius: 2px;
      opacity: 0;
      transform: translateY(4px);
      animation: underlineFadeSlideIn 0.4s ease forwards;
    }

    @keyframes underlineFadeSlideIn {
      0% {
        width: 0;
        opacity: 0;
        transform: translateY(4px);
      }
      60% {
        width: 100%;
        opacity: 1;
        transform: translateY(0);
      }
      100% {
        width: 100%;
        opacity: 1;
        transform: translateY(0);
      }
    }
  </style>
</head>
<body class="bg-gradient-to-br from-indigo-900 to-blue-700 text-white min-h-screen flex flex-col">

  {% include 'partials/_header.html' %}

  <!-- ðŸ”¹ Toast Flash Messages -->
  {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
      <div id="flash-container" class="fixed top-4 right-4 w-80 space-y-3 z-50">
        {% for category, message in messages %}
          {% set alert_classes = {
            "success": "bg-green-100 border-green-400 text-green-700",
            "error": "bg-red-100 border-red-400 text-red-700",
            "warning": "bg-yellow-100 border-yellow-400 text-yellow-700",
            "info": "bg-blue-100 border-blue-400 text-blue-700"
          } %}
          <div class="flash-message relative border-l-4 p-4 rounded shadow-lg transition-opacity duration-1000 {{ alert_classes.get(category, 'bg-gray-100 border-gray-400 text-gray-700') }}">
            <p class="font-medium">{{ message }}</p>
            <!-- Close button -->
            <button onclick="this.parentElement.remove()" class="absolute top-2 right-3 text-lg font-bold text-gray-500 hover:text-gray-700">&times;</button>
          </div>
        {% endfor %}
      </div>
    {% endif %}
  {% endwith %}

  <main class="flex-grow">
    {% block content %}{% endblock %}
  </main>

  {% include 'partials/_footer.html' %}

  <script>
    AOS.init();

    const menuBtn = document.getElementById('menu-btn');
    const mobileMenuContainer = document.getElementById('mobile-menu-container');
    const openIcon = document.getElementById('menu-open-icon');
    const closeIcon = document.getElementById('menu-close-icon');
    const menuLinks = document.querySelectorAll('.menu-link');

    if (menuBtn) {
      menuBtn.addEventListener('click', () => {
        const isOpen = mobileMenuContainer.classList.toggle('open');
        openIcon.classList.toggle('hidden');
        closeIcon.classList.toggle('hidden');

        if (isOpen) {
          menuLinks.forEach((link, index) => {
            link.classList.remove('show');
            setTimeout(() => {
              link.classList.add('show');
            }, index * 150);
          });
        } else {
          menuLinks.forEach(link => link.classList.remove('show'));
        }
      });
    }

    // ðŸ”¹ Auto-underline active nav link based on current page
    document.addEventListener('DOMContentLoaded', () => {
      const currentPath = window.location.pathname.replace(/\/$/, '');
      document.querySelectorAll('nav a').forEach(link => {
        const linkPath = link.getAttribute('href').replace(/\/$/, '');
        if (linkPath && currentPath.endsWith(linkPath)) {
          link.classList.add('active-link');
        }
      });
    });

    // ðŸ”¹ Auto-hide flash messages after 4 seconds
    setTimeout(() => {
      document.querySelectorAll(".flash-message").forEach(el => {
        el.classList.add("opacity-0"); // fade out
        setTimeout(() => el.remove(), 1000); // remove after fade
      });
    }, 4000);
  </script>
</body>
</html>
